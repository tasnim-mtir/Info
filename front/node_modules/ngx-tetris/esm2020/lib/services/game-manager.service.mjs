import { Injectable } from '@angular/core';
import { PiecesFactory } from '../classes/PiecesFactory';
import { Subject } from 'rxjs/internal/Subject';
import * as i0 from "@angular/core";
const SPAWN_POSITION_X = 4;
const SPAWN_POSITION_Y = -4;
export class Tile {
    constructor() {
        this.solid = false;
        this.color = null;
    }
}
export class GameManagerService {
    constructor() {
        this.settings = {
            tileSize: null
        };
        this._gridSize = { width: 0, height: 0 };
        this._locked = true;
        this._lineCleared = new Subject();
        this._gameOver = new Subject();
        this._keepMovingDown = false;
        this.lineCleared$ = this._lineCleared.asObservable();
        this.gameOver$ = this._gameOver.asObservable();
    }
    get elementsInRow() {
        return this._gridSize.width;
    }
    initialize(width, height, gameSpeed, tileSize) {
        this._gridSize.width = width;
        this._gridSize.height = height;
        this._gameSpeed = gameSpeed;
        this._piecesFactory = new PiecesFactory(this._gridSize);
        if (tileSize) {
            this.settings.tileSize = tileSize;
        }
        this._initializeEmptyBoard();
        this._spawnNewPiece();
        this._drawPiece();
    }
    start() {
        clearInterval(this._gameInterval);
        this._gameInterval = setInterval(() => {
            this._update();
        }, this._gameSpeed);
        this._locked = false;
    }
    stop() {
        this._locked = true;
        clearInterval(this._gameInterval);
    }
    reset() {
        const emptyTile = new Tile();
        for (let pos = 0; pos < this.grid.length; pos++) {
            if (this.grid[pos].color || this.grid[pos].solid) {
                this.__changeCell(pos, emptyTile);
            }
        }
        this._spawnNewPiece();
        this._drawPiece();
    }
    moveLeft() {
        if (this._locked) {
            return;
        }
        this._clearPiece();
        this._piece.store();
        this._piece.moveLeft();
        if (this._collidesLeft()) {
            this._piece.revert();
        }
        this._drawPiece();
    }
    moveRight() {
        if (this._locked) {
            return;
        }
        this._clearPiece();
        this._piece.store();
        this._piece.moveRight();
        if (this._collidesRight()) {
            this._piece.revert();
        }
        this._drawPiece();
    }
    drop() {
        if (this._locked) {
            return;
        }
        this._keepMovingDown = true;
        while (!this._collidesBottom() && this._keepMovingDown) {
            this._update();
        }
    }
    rotate() {
        if (this._locked) {
            return;
        }
        this._clearPiece();
        this._piece.store();
        this._piece.rotate();
        while (this._collidesRight()) {
            this._piece.moveLeft();
            if (this._collidesLeft()) {
                this._piece.revert();
                break;
            }
        }
        this._drawPiece();
    }
    moveDown() {
        this._update();
    }
    _clearFullLines() {
        for (let row = this._gridSize.height - 1; row >= 0; row--) {
            let isFull = true;
            for (let col = 0; col < this._gridSize.width; col++) {
                const pos = row * this._gridSize.width + col;
                if (this.grid[pos].solid === false) {
                    isFull = false;
                    break;
                }
            }
            if (isFull) {
                const emptyRow = Array.apply(null, Array(this._gridSize.width))
                    .map((idx) => new Tile());
                const topPortion = this.grid.slice(0, row * this._gridSize.width);
                this.grid.splice(0, ++row * this._gridSize.width, ...emptyRow.concat(topPortion));
                this._lineCleared.next();
            }
        }
    }
    _update() {
        if (this._locked) {
            return;
        }
        this._locked = true;
        this._piece.revert();
        this._clearPiece();
        this._piece.store();
        this._piece.moveDown();
        if (this._collidesBottom()) {
            this._keepMovingDown = false;
            this._piece.revert();
            this._markSolid();
            this._drawPiece();
            this._clearFullLines();
            this._spawnNewPiece();
            if (this._isGameOver()) {
                this._onGameOver();
                return;
            }
        }
        this._drawPiece();
        this._locked = false;
    }
    _isGameOver() {
        this._piece.store();
        this._piece.moveDown();
        if (this._collidesBottom()) {
            return true;
        }
        this._piece.revert();
        return false;
    }
    _onGameOver() {
        this.stop();
        this._gameOver.next();
    }
    _spawnNewPiece() {
        this._piece = this._piecesFactory.getRandomPiecePiece(SPAWN_POSITION_X, SPAWN_POSITION_Y);
    }
    _initializeEmptyBoard() {
        const cellsCount = this._gridSize.width * this._gridSize.height;
        this.grid = Array.apply(null, Array(cellsCount))
            .map((idx) => new Tile());
    }
    _clearPiece() {
        this._piece.positionsOnGrid
            .forEach((pos) => {
            this.__changeCell(pos, { color: undefined });
        });
    }
    _drawPiece() {
        this._piece.clearStore();
        this._piece.positionsOnGrid
            .forEach((pos) => {
            this.__changeCell(pos, { color: this._piece.color });
        });
    }
    _markSolid() {
        this._piece.positionsOnGrid.forEach((pos) => {
            this.__changeCell(pos, { solid: true });
        });
    }
    __changeCell(pos, data = {}) {
        this.grid[pos] = Object.assign({}, this.grid[pos], data);
    }
    _collidesBottom() {
        if (this._piece.bottomRow >= this._gridSize.height) {
            return true;
        }
        return this.__collides();
    }
    _collidesLeft() {
        if (this._piece.leftCol < 0) {
            return true;
        }
        return this.__collides();
    }
    _collidesRight() {
        if (this._piece.rightCol >= this._gridSize.width) {
            return true;
        }
        return this.__collides();
    }
    __collides() {
        return this._piece.positionsOnGrid
            .some((pos) => {
            if (pos > 0 && this.grid[pos] && this.grid[pos].solid) {
                return true;
            }
            return false;
        });
    }
}
GameManagerService.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: GameManagerService, deps: [], target: i0.ɵɵFactoryTarget.Injectable });
GameManagerService.ɵprov = i0.ɵɵngDeclareInjectable({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: GameManagerService });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: GameManagerService, decorators: [{
            type: Injectable
        }], ctorParameters: function () { return []; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FtZS1tYW5hZ2VyLnNlcnZpY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtdGV0cmlzL3NyYy9saWIvc2VydmljZXMvZ2FtZS1tYW5hZ2VyLnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFDLFVBQVUsRUFBQyxNQUFNLGVBQWUsQ0FBQztBQUV6QyxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sMEJBQTBCLENBQUM7QUFFdkQsT0FBTyxFQUFDLE9BQU8sRUFBQyxNQUFNLHVCQUF1QixDQUFDOztBQUU5QyxNQUFNLGdCQUFnQixHQUFHLENBQUMsQ0FBQztBQUMzQixNQUFNLGdCQUFnQixHQUFHLENBQUMsQ0FBQyxDQUFDO0FBRTVCLE1BQU0sT0FBTyxJQUFJO0lBQWpCO1FBQ0ksVUFBSyxHQUFHLEtBQUssQ0FBQztRQUNkLFVBQUssR0FBRyxJQUFJLENBQUM7SUFDakIsQ0FBQztDQUFBO0FBR0QsTUFBTSxPQUFPLGtCQUFrQjtJQWdDM0I7UUEvQk8sYUFBUSxHQUFHO1lBQ2QsUUFBUSxFQUFFLElBQUk7U0FDakIsQ0FBQztRQVlNLGNBQVMsR0FHYixFQUFFLEtBQUssRUFBRSxDQUFDLEVBQUUsTUFBTSxFQUFFLENBQUMsRUFBRSxDQUFDO1FBS3BCLFlBQU8sR0FBRyxJQUFJLENBQUM7UUFJZixpQkFBWSxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFDbkMsY0FBUyxHQUFHLElBQUksT0FBTyxFQUFRLENBQUM7UUFFaEMsb0JBQWUsR0FBRyxLQUFLLENBQUM7UUFHNUIsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3JELElBQUksQ0FBQyxTQUFTLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxZQUFZLEVBQUUsQ0FBQztJQUNuRCxDQUFDO0lBOUJELElBQVcsYUFBYTtRQUNwQixPQUFPLElBQUksQ0FB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U0FBUyxJQUFJLElBQUksQ0FBQyxTQUFTLENBQUMsTUFBTSxFQUFFO1lBQ2hELE9BQU8sSUFBSSxDQUFDO1NBQ2Y7UUFDRCxPQUFPLElBQUksQ0FBQyxVQUFVLEVBQUUsQ0FBQztJQUM3QixDQUFDO0lBRU8sYUFBYTtRQUNqQixJQUFJLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTyxHQUFHLENBQUMsRUFBRTtZQUN6QixPQUFPLElBQUksQ0FBQztTQUNmO1FBRUQsT0FBTyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUVPLGNBQWM7UUFDbEIsSUFBSSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLEtBQUssRUFBRTtZQUM5QyxPQUFPLElBQUksQ0FBQztTQUNmO1FBRUQsT0FBTyxJQUFJLENBQUMsVUFBVSxFQUFFLENBQUM7SUFDN0IsQ0FBQztJQUVPLFVBQVU7UUFDZCxPQUFPLElBQUksQ0FBQyxNQUFNLENBQUMsZUFBZTthQUM3QixJQUFJLENBQUMsQ0FBQyxHQUFHLEVBQUUsRUFBRTtZQUNWLElBQUksR0FBRyxHQUFHLENBQUMsSUFBSSxJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLElBQUksQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsS0FBSyxFQUFFO2dCQUNuRCxPQUFPLElBQUksQ0FBQzthQUNmO1lBRUQsT0FBTyxLQUFLLENBQUM7UUFDakIsQ0FBQyxDQUFDLENBQUM7SUFDWCxDQUFDOzsrR0F2UlEsa0JBQWtCO21IQUFsQixrQkFBa0I7MkZBQWxCLGtCQUFrQjtrQkFEOUIsVUFBVSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7SW5qZWN0YWJsZX0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQge1BpZWNlfSBmcm9tICcuLi9jbGFzc2VzL1BpZWNlJztcbmltcG9ydCB7UGllY2VzRmFjdG9yeX0gZnJvbSAnLi4vY2xhc3Nlcy9QaWVjZXNGYWN0b3J5JztcbmltcG9ydCB7T2JzZXJ2YWJsZX0gZnJvbSAncnhqcy9pbnRlcm5hbC9PYnNlcnZhYmxlJztcbmltcG9ydCB7U3ViamVjdH0gZnJvbSAncnhqcy9pbnRlcm5hbC9TdWJqZWN0JztcblxuY29uc3QgU1BBV05fUE9TSVRJT05fWCA9IDQ7XG5jb25zdCBTUEFXTl9QT1NJVElPTl9ZID0gLTQ7XG5cbmV4cG9ydCBjbGFzcyBUaWxlIHtcbiAgICBzb2xpZCA9IGZhbHNlO1xuICAgIGNvbG9yID0gbnVsbDtcbn1cblxuQEluamVjdGFibGUoKVxuZXhwb3J0IGNsYXNzIEdhbWVNYW5hZ2VyU2VydmljZSB7XG4gICAgcHVibGljIHNldHRpbmdzID0ge1xuICAgICAgICB0aWxlU2l6ZTogbnVsbFxuICAgIH07XG5cbiAgICBwdWJsaWMgZ2V0IGVsZW1lbnRzSW5Sb3coKSB7XG4gICAgICAgIHJldHVybiB0aGlzLl9ncmlkU2l6ZS53aWR0aDtcbiAgICB9XG5cbiAgICAvLyBzZXJpYWxpemVkIGdyaWQgOilcbiAgICBwdWJsaWMgZ3JpZDogQXJyYXk8VGlsZT47XG5cbiAgICBwdWJsaWMgbGluZUNsZWFyZWQkOiBPYnNlcnZhYmxlPGFueT47XG4gICAgcHVibGljIGdhbWVPdmVyJDogT2JzZXJ2YWJsZTxhbnk+O1xuXG4gICAgcHJpdmF0ZSBfZ3JpZFNpemU6IHtcbiAgICAgICAgd2lkdGg6IG51bWJlcixcbiAgICAgICAgaGVpZ2h0OiBudW1iZXJcbiAgICB9ID0geyB3aWR0aDogMCwgaGVpZ2h0OiAwIH07XG5cbiAgICBwcml2YXRlIF9waWVjZTogUGllY2U7XG4gICAgcHJpdmF0ZSBfcGllY2VzRmFjdG9yeTogUGllY2VzRmFjdG9yeTtcblxuICAgIHByaXZhdGUgX2xvY2tlZCA9IHRydWU7XG4gICAgcHJpdmF0ZSBfZ2FtZVNwZWVkOiBudW1iZXI7XG4gICAgcHJpdmF0ZSBfZ2FtZUludGVydmFsOiBudW1iZXJ8dW5kZWZpbmVkO1xuXG4gICAgcHJpdmF0ZSBfbGluZUNsZWFyZWQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuICAgIHByaXZhdGUgX2dhbWVPdmVyID0gbmV3IFN1YmplY3Q8dm9pZD4oKTtcblxuICAgIHByaXZhdGUgX2tlZXBNb3ZpbmdEb3duID0gZmFsc2U7XG5cbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5saW5lQ2xlYXJlZCQgPSB0aGlzLl9saW5lQ2xlYXJlZC5hc09ic2VydmFibGUoKTtcbiAgICAgICAgdGhpcy5nYW1lT3ZlciQgPSB0aGlzLl9nYW1lT3Zlci5hc09ic2VydmFibGUoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgaW5pdGlhbGl6ZSh3aWR0aDogbnVtYmVyLCBoZWlnaHQ6IG51bWJlciwgZ2FtZVNwZWVkOiBudW1iZXIsIHRpbGVTaXplPzogYW55KSB7XG4gICAgICAgIHRoaXMuX2dyaWRTaXplLndpZHRoID0gd2lkdGg7XG4gICAgICAgIHRoaXMuX2dyaWRTaXplLmhlaWdodCA9IGhlaWdodDtcbiAgICAgICAgdGhpcy5fZ2FtZVNwZWVkID0gZ2FtZVNwZWVkO1xuICAgICAgICB0aGlzLl9waWVjZXNGYWN0b3J5ID0gbmV3IFBpZWNlc0ZhY3RvcnkodGhpcy5fZ3JpZFNpemUpO1xuXG4gICAgICAgIGlmICh0aWxlU2l6ZSkge1xuICAgICAgICAgICAgdGhpcy5zZXR0aW5ncy50aWxlU2l6ZSA9IHRpbGVTaXplO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5faW5pdGlhbGl6ZUVtcHR5Qm9hcmQoKTtcblxuICAgICAgICB0aGlzLl9zcGF3bk5ld1BpZWNlKCk7XG4gICAgICAgIHRoaXMuX2RyYXdQaWVjZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdGFydCgpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbCh0aGlzLl9nYW1lSW50ZXJ2YWwpO1xuICAgICAgICB0aGlzLl9nYW1lSW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGUoKTtcbiAgICAgICAgfSwgdGhpcy5fZ2FtZVNwZWVkKTtcbiAgICAgICAgdGhpcy5fbG9ja2VkID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcHVibGljIHN0b3AoKSB7XG4gICAgICAgIHRoaXMuX2xvY2tlZCA9IHRydWU7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwodGhpcy5fZ2FtZUludGVydmFsKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmVzZXQoKSB7XG4gICAgICAgIGNvbnN0IGVtcHR5VGlsZSA9IG5ldyBUaWxlKCk7XG4gICAgICAgIGZvciAobGV0IHBvcyA9IDA7IHBvcyA8IHRoaXMuZ3JpZC5sZW5ndGg7IHBvcysrKSB7XG4gICAgICAgICAgICBpZiAodGhpcy5ncmlkW3Bvc10uY29sb3IgfHwgdGhpcy5ncmlkW3Bvc10uc29saWQpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9fY2hhbmdlQ2VsbChwb3MsIGVtcHR5VGlsZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9zcGF3bk5ld1BpZWNlKCk7XG4gICAgICAgIHRoaXMuX2RyYXdQaWVjZSgpO1xuICAgIH1cblxuICAgIHB1YmxpYyBtb3ZlTGVmdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NsZWFyUGllY2UoKTtcbiAgICAgICAgdGhpcy5fcGllY2Uuc3RvcmUoKTtcblxuICAgICAgICB0aGlzLl9waWVjZS5tb3ZlTGVmdCgpO1xuICAgICAgICBpZiAodGhpcy5fY29sbGlkZXNMZWZ0KCkpIHtcbiAgICAgICAgICAgIHRoaXMuX3BpZWNlLnJldmVydCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZHJhd1BpZWNlKCk7XG4gICAgfVxuXG4gICAgcHVibGljIG1vdmVSaWdodCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2NsZWFyUGllY2UoKTtcbiAgICAgICAgdGhpcy5fcGllY2Uuc3RvcmUoKTtcblxuICAgICAgICB0aGlzLl9waWVjZS5tb3ZlUmlnaHQoKTtcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpZGVzUmlnaHQoKSkge1xuICAgICAgICAgICAgdGhpcy5fcGllY2UucmV2ZXJ0KCk7XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9kcmF3UGllY2UoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgZHJvcCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX2xvY2tlZCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuX2tlZXBNb3ZpbmdEb3duID0gdHJ1ZTtcbiAgICAgICAgd2hpbGUgKCF0aGlzLl9jb2xsaWRlc0JvdHRvbSgpICYmIHRoaXMuX2tlZXBNb3ZpbmdEb3duKSB7XG4gICAgICAgICAgICB0aGlzLl91cGRhdGUoKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHB1YmxpYyByb3RhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLl9sb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX2NsZWFyUGllY2UoKTtcbiAgICAgICAgdGhpcy5fcGllY2Uuc3RvcmUoKTtcblxuICAgICAgICB0aGlzLl9waWVjZS5yb3RhdGUoKTtcbiAgICAgICAgd2hpbGUgKHRoaXMuX2NvbGxpZGVzUmlnaHQoKSkge1xuICAgICAgICAgICAgdGhpcy5fcGllY2UubW92ZUxlZnQoKTtcblxuICAgICAgICAgICAgaWYgKHRoaXMuX2NvbGxpZGVzTGVmdCgpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5fcGllY2UucmV2ZXJ0KCk7XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICB0aGlzLl9kcmF3UGllY2UoKTtcbiAgICB9XG5cbiAgICBwdWJsaWMgbW92ZURvd24oKSB7XG4gICAgICAgIHRoaXMuX3VwZGF0ZSgpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2NsZWFyRnVsbExpbmVzKCkge1xuICAgICAgICBmb3IgKGxldCByb3cgPSB0aGlzLl9ncmlkU2l6ZS5oZWlnaHQgLSAxOyByb3cgPj0gMDsgcm93LS0pIHtcbiAgICAgICAgICAgIGxldCBpc0Z1bGwgPSB0cnVlO1xuICAgICAgICAgICAgZm9yIChsZXQgY29sID0gMDsgY29sIDwgdGhpcy5fZ3JpZFNpemUud2lkdGg7IGNvbCsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcG9zID0gcm93ICogdGhpcy5fZ3JpZFNpemUud2lkdGggKyBjb2w7XG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuZ3JpZFtwb3NdLnNvbGlkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICBpc0Z1bGwgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZiAoaXNGdWxsKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgZW1wdHlSb3cgPSBBcnJheS5hcHBseShudWxsLCBBcnJheSh0aGlzLl9ncmlkU2l6ZS53aWR0aCkpXG4gICAgICAgICAgICAgICAgICAgIC5tYXAoKGlkeCkgPT4gbmV3IFRpbGUoKSk7XG5cbiAgICAgICAgICAgICAgICBjb25zdCB0b3BQb3J0aW9uID0gdGhpcy5ncmlkLnNsaWNlKDAsIHJvdyAqIHRoaXMuX2dyaWRTaXplLndpZHRoKTtcblxuICAgICAgICAgICAgICAgIHRoaXMuZ3JpZC5zcGxpY2UoMCwgKytyb3cgKiB0aGlzLl9ncmlkU2l6ZS53aWR0aCwgLi4uZW1wdHlSb3cuY29uY2F0KHRvcFBvcnRpb24pKTtcbiAgICAgICAgICAgICAgICB0aGlzLl9saW5lQ2xlYXJlZC5uZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIF91cGRhdGUoKSB7XG4gICAgICAgIGlmICh0aGlzLl9sb2NrZWQpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLl9sb2NrZWQgPSB0cnVlO1xuICAgICAgICB0aGlzLl9waWVjZS5yZXZlcnQoKTtcblxuICAgICAgICB0aGlzLl9jbGVhclBpZWNlKCk7XG4gICAgICAgIHRoaXMuX3BpZWNlLnN0b3JlKCk7XG5cbiAgICAgICAgdGhpcy5fcGllY2UubW92ZURvd24oKTtcbiAgICAgICAgaWYgKHRoaXMuX2NvbGxpZGVzQm90dG9tKCkpIHtcbiAgICAgICAgICAgIHRoaXMuX2tlZXBNb3ZpbmdEb3duID0gZmFsc2U7XG4gICAgICAgICAgICB0aGlzLl9waWVjZS5yZXZlcnQoKTtcbiAgICAgICAgICAgIHRoaXMuX21hcmtTb2xpZCgpO1xuICAgICAgICAgICAgdGhpcy5fZHJhd1BpZWNlKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX2NsZWFyRnVsbExpbmVzKCk7XG5cbiAgICAgICAgICAgIHRoaXMuX3NwYXduTmV3UGllY2UoKTtcbiAgICAgICAgICAgIGlmICh0aGlzLl9pc0dhbWVPdmVyKCkpIHtcbiAgICAgICAgICAgICAgICB0aGlzLl9vbkdhbWVPdmVyKCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5fZHJhd1BpZWNlKCk7XG4gICAgICAgIHRoaXMuX2xvY2tlZCA9IGZhbHNlO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2lzR2FtZU92ZXIoKSB7XG4gICAgICAgIHRoaXMuX3BpZWNlLnN0b3JlKCk7XG4gICAgICAgIHRoaXMuX3BpZWNlLm1vdmVEb3duKCk7XG4gICAgICAgIGlmICh0aGlzLl9jb2xsaWRlc0JvdHRvbSgpKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHRoaXMuX3BpZWNlLnJldmVydCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfb25HYW1lT3ZlcigpIHtcbiAgICAgICAgdGhpcy5zdG9wKCk7XG4gICAgICAgIHRoaXMuX2dhbWVPdmVyLm5leHQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9zcGF3bk5ld1BpZWNlKCkge1xuICAgICAgICB0aGlzLl9waWVjZSA9IHRoaXMuX3BpZWNlc0ZhY3RvcnkuZ2V0UmFuZG9tUGllY2VQaWVjZShTUEFXTl9QT1NJVElPTl9YLCBTUEFXTl9QT1NJVElPTl9ZKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9pbml0aWFsaXplRW1wdHlCb2FyZCgpIHtcbiAgICAgICAgY29uc3QgY2VsbHNDb3VudCA9IHRoaXMuX2dyaWRTaXplLndpZHRoICogdGhpcy5fZ3JpZFNpemUuaGVpZ2h0O1xuICAgICAgICB0aGlzLmdyaWQgPSBBcnJheS5hcHBseShudWxsLCBBcnJheShjZWxsc0NvdW50KSlcbiAgICAgICAgICAgIC5tYXAoKGlkeCkgPT4gbmV3IFRpbGUoKSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfY2xlYXJQaWVjZSgpIHtcbiAgICAgICAgdGhpcy5fcGllY2UucG9zaXRpb25zT25HcmlkXG4gICAgICAgICAgICAuZm9yRWFjaCgocG9zKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5fX2NoYW5nZUNlbGwocG9zLCB7Y29sb3I6IHVuZGVmaW5lZH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfZHJhd1BpZWNlKCkge1xuICAgICAgICB0aGlzLl9waWVjZS5jbGVhclN0b3JlKCk7XG4gICAgICAgIHRoaXMuX3BpZWNlLnBvc2l0aW9uc09uR3JpZFxuICAgICAgICAgICAgLmZvckVhY2goKHBvcykgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuX19jaGFuZ2VDZWxsKHBvcywge2NvbG9yOiB0aGlzLl9waWVjZS5jb2xvcn0pO1xuICAgICAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBfbWFya1NvbGlkKCkge1xuICAgICAgICB0aGlzLl9waWVjZS5wb3NpdGlvbnNPbkdyaWQuZm9yRWFjaCgocG9zKSA9PiB7XG4gICAgICAgICAgICB0aGlzLl9fY2hhbmdlQ2VsbChwb3MsIHtzb2xpZDogdHJ1ZX0pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9fY2hhbmdlQ2VsbChwb3M6IG51bWJlciwgZGF0YSA9IHt9KSB7XG4gICAgICAgIHRoaXMuZ3JpZFtwb3NdID0gT2JqZWN0LmFzc2lnbih7fSwgdGhpcy5ncmlkW3Bvc10sIGRhdGEpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2NvbGxpZGVzQm90dG9tKCkge1xuICAgICAgICBpZiAodGhpcy5fcGllY2UuYm90dG9tUm93ID49IHRoaXMuX2dyaWRTaXplLmhlaWdodCkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRoaXMuX19jb2xsaWRlcygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2NvbGxpZGVzTGVmdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuX3BpZWNlLmxlZnRDb2wgPCAwKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiB0aGlzLl9fY29sbGlkZXMoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9jb2xsaWRlc1JpZ2h0KCkge1xuICAgICAgICBpZiAodGhpcy5fcGllY2UucmlnaHRDb2wgPj0gdGhpcy5fZ3JpZFNpemUud2lkdGgpIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuX19jb2xsaWRlcygpO1xuICAgIH1cblxuICAgIHByaXZhdGUgX19jb2xsaWRlcygpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuX3BpZWNlLnBvc2l0aW9uc09uR3JpZFxuICAgICAgICAgICAgLnNvbWUoKHBvcykgPT4ge1xuICAgICAgICAgICAgICAgIGlmIChwb3MgPiAwICYmIHRoaXMuZ3JpZFtwb3NdICYmIHRoaXMuZ3JpZFtwb3NdLnNvbGlkKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH0pO1xuICAgIH1cbn1cbiJdfQ==