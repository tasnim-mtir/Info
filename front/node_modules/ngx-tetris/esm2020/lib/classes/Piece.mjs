export var PieceRotation;
(function (PieceRotation) {
    PieceRotation[PieceRotation["DEG_0"] = 0] = "DEG_0";
    PieceRotation[PieceRotation["DEG_90"] = 1] = "DEG_90";
    PieceRotation[PieceRotation["DEG_180"] = 2] = "DEG_180";
    PieceRotation[PieceRotation["DEG_270"] = 3] = "DEG_270";
})(PieceRotation || (PieceRotation = {}));
export var PieceTypes;
(function (PieceTypes) {
    PieceTypes[PieceTypes["Dot"] = 1] = "Dot";
    PieceTypes[PieceTypes["Box"] = 2] = "Box";
    PieceTypes[PieceTypes["Line"] = 3] = "Line";
    PieceTypes[PieceTypes["T"] = 4] = "T";
    PieceTypes[PieceTypes["L"] = 5] = "L";
    PieceTypes[PieceTypes["Lr"] = 6] = "Lr";
    PieceTypes[PieceTypes["Z"] = 7] = "Z";
    PieceTypes[PieceTypes["S"] = 8] = "S";
})(PieceTypes || (PieceTypes = {}));
// picked from https://www.romanzolotarev.com/pico-8-color-palette/
export var PieceColors;
(function (PieceColors) {
    PieceColors["Box"] = "color-box";
    PieceColors["Dot"] = "color-dot";
    PieceColors["Line"] = "color-line";
    PieceColors["T"] = "color-t";
    PieceColors["L"] = "color-l";
    PieceColors["Lr"] = "color-lr";
    PieceColors["Z"] = "color-z";
    PieceColors["S"] = "color-s";
})(PieceColors || (PieceColors = {}));
export class Piece {
    constructor(x, y, gridSize, maps) {
        this.color = 'red';
        this.rotation = PieceRotation.DEG_0;
        this.map = [
            [], []
        ];
        this._lastConfig = null;
        this._gridSize = gridSize;
        this.x = x;
        this.y = y;
        this._maps = maps;
        this.map = this._maps[this.rotation];
    }
    get positionsOnGrid() {
        const acc = [];
        for (let row = 0; row < 4; row++) {
            for (let col = 0; col < 4; col++) {
                if (this.map[row][col]) {
                    const pos = (this.y + row) * this._gridSize.width + this.x + col;
                    if (pos > 0) {
                        acc.push(pos);
                    }
                }
            }
        }
        return acc;
    }
    store() {
        this._lastConfig = {
            x: this.x,
            y: this.y,
            rotation: this.rotation,
            map: this.map
        };
    }
    clearStore() {
        this._lastConfig = null;
    }
    revert() {
        if (this._lastConfig) {
            for (const x in this._lastConfig) {
                if (this._lastConfig.hasOwnProperty(x)) {
                    // @ts-ignore
                    this[x] = this._lastConfig[x];
                }
            }
            this._lastConfig = null;
        }
    }
    rotate() {
        const keys = Object.keys(this._maps);
        let idx = keys.indexOf(this.rotation.toString());
        if (idx >= keys.length - 1) {
            this.rotation = keys[0];
        }
        else {
            this.rotation = keys[++idx];
        }
        this.map = this._maps[this.rotation];
    }
    moveDown() {
        this.y++;
    }
    moveRight() {
        this.x++;
    }
    moveLeft() {
        this.x--;
    }
    get bottomRow() {
        return this.y + 3;
    }
    get rightCol() {
        let col = 3;
        while (col >= 0) {
            for (let row = 0; row <= 3; row++) {
                if (this.map[row][col]) {
                    return this.x + col;
                }
            }
            col--;
        }
        return 0;
    }
    get leftCol() {
        return this.x;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiUGllY2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi9wcm9qZWN0cy9uZ3gtdGV0cmlzL3NyYy9saWIvY2xhc3Nlcy9QaWVjZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFFQSxNQUFNLENBQU4sSUFBWSxhQUtYO0FBTEQsV0FBWSxhQUFhO0lBQ3JCLG1EQUFTLENBQUE7SUFDVCxxREFBVSxDQUFBO0lBQ1YsdURBQVcsQ0FBQTtJQUNYLHVEQUFXLENBQUE7QUFDZixDQUFDLEVBTFcsYUFBYSxLQUFiLGFBQWEsUUFLeEI7QUFHRCxNQUFNLENBQU4sSUFBWSxVQVNYO0FBVEQsV0FBWSxVQUFVO0lBQ2xCLHlDQUFPLENBQUE7SUFDUCx5Q0FBTyxDQUFBO0lBQ1AsMkNBQVEsQ0FBQTtJQUNSLHFDQUFLLENBQUE7SUFDTCxxQ0FBSyxDQUFBO0lBQ0wsdUNBQU0sQ0FBQTtJQUNOLHFDQUFLLENBQUE7SUFDTCxxQ0FBSyxDQUFBO0FBQ1QsQ0FBQyxFQVRXLFVBQVUsS0FBVixVQUFVLFFBU3JCO0FBRUQsbUVBQW1FO0FBQ25FLE1BQU0sQ0FBTixJQUFZLFdBU1g7QUFURCxXQUFZLFdBQVc7SUFDbkIsZ0NBQWlCLENBQUE7SUFDakIsZ0NBQWlCLENBQUE7SUFDakIsa0NBQW1CLENBQUE7SUFDbkIsNEJBQWEsQ0FBQTtJQUNiLDRCQUFhLENBQUE7SUFDYiw4QkFBZSxDQUFBO0lBQ2YsNEJBQWEsQ0FBQTtJQUNiLDRCQUFhLENBQUE7QUFDakIsQ0FBQyxFQVRXLFdBQVcsS0FBWCxXQUFXLFFBU3RCO0FBRUQsTUFBTSxPQUFPLEtBQUs7SUFjZCxZQUFZLENBQVMsRUFBRSxDQUFTLEVBQUUsUUFBa0IsRUFBRSxJQUFlO1FBYnJFLFVBQUssR0FBRyxLQUFLLENBQUM7UUFHZCxhQUFRLEdBQWtCLGFBQWEsQ0FBQyxLQUFLLENBQUM7UUFHdkMsUUFBRyxHQUFhO1lBQ25CLEVBQUUsRUFBRSxFQUFFO1NBQ1QsQ0FBQztRQUdRLGdCQUFX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Q0FBQztJQUNiLENBQUM7SUFFRCxJQUFJLFNBQVM7UUFDVCxPQUFPLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0lBQ3RCLENBQUM7SUFFRCxJQUFJLFFBQVE7UUFDUixJQUFJLEdBQUcsR0FBRyxDQUFDLENBQUM7UUFDWixPQUFPLEdBQUcsSUFBSSxDQUFDLEVBQUU7WUFDYixLQUFLLElBQUksR0FBRyxHQUFHLENBQUMsRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLEdBQUcsRUFBRSxFQUFFO2dCQUMvQixJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLEVBQUU7b0JBQ3BCLE9BQU8sSUFBSSxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUM7aUJBQ3ZCO2FBQ0o7WUFDRCxHQUFHLEVBQUUsQ0FBQztTQUNUO1FBRUQsT0FBTyxDQUFDLENBQUM7SUFDYixDQUFDO0lBRUQsSUFBSSxPQUFPO1FBQ1AsT0FBTyxJQUFJLENBQUMsQ0FBQyxDQUFDO0lBQ2xCLENBQUM7Q0FDSiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7R3JpZFNpemUsIFBpZWNlTWFwLCBQaWVjZU1hcHN9IGZyb20gJy4uL2RlZmluaXRpb25zJztcblxuZXhwb3J0IGVudW0gUGllY2VSb3RhdGlvbiB7XG4gICAgREVHXzAgPSAwLFxuICAgIERFR185MCA9IDEsXG4gICAgREVHXzE4MCA9IDIsXG4gICAgREVHXzI3MCA9IDNcbn1cblxuXG5leHBvcnQgZW51bSBQaWVjZVR5cGVzIHtcbiAgICBEb3QgPSAxLFxuICAgIEJveCA9IDIsXG4gICAgTGluZSA9IDMsXG4gICAgVCA9IDQsXG4gICAgTCA9IDUsXG4gICAgTHIgPSA2LFxuICAgIFogPSA3LFxuICAgIFMgPSA4XG59XG5cbi8vIHBpY2tlZCBmcm9tIGh0dHBzOi8vd3d3LnJvbWFuem9sb3RhcmV2LmNvbS9waWNvLTgtY29sb3ItcGFsZXR0ZS9cbmV4cG9ydCBlbnVtIFBpZWNlQ29sb3JzIHtcbiAgICBCb3ggPSAnY29sb3ItYm94JyxcbiAgICBEb3QgPSAnY29sb3ItZG90JyxcbiAgICBMaW5lID0gJ2NvbG9yLWxpbmUnLFxuICAgIFQgPSAnY29sb3ItdCcsXG4gICAgTCA9ICdjb2xvci1sJyxcbiAgICBMciA9ICdjb2xvci1scicsXG4gICAgWiA9ICdjb2xvci16JyxcbiAgICBTID0gJ2NvbG9yLXMnXG59XG5cbmV4cG9ydCBjbGFzcyBQaWVjZSB7XG4gICAgY29sb3IgPSAncmVkJztcbiAgICB4OiBudW1iZXI7XG4gICAgeTogbnVtYmVyO1xuICAgIHJvdGF0aW9uOiBQaWVjZVJvdGF0aW9uID0gUGllY2VSb3RhdGlvbi5ERUdfMDtcblxuICAgIHByb3RlY3RlZCBfbWFwczogUGllY2VNYXBzO1xuICAgIHB1YmxpYyBtYXA6IFBpZWNlTWFwID0gW1xuICAgICAgICBbXSwgW11cbiAgICBdO1xuXG4gICAgcHJvdGVjdGVkIF9ncmlkU2l6ZTtcbiAgICBwcm90ZWN0ZWQgX2xhc3RDb25maWc6IHsgW2tleTogc3RyaW5nXTogYW55IH0gfCBudWxsID0gbnVsbDtcblxuICAgIGNvbnN0cnVjdG9yKHg6IG51bWJlciwgeTogbnVtYmVyLCBncmlkU2l6ZTogR3JpZFNpemUsIG1hcHM6IFBpZWNlTWFwcykge1xuICAgICAgICB0aGlzLl9ncmlkU2l6ZSA9IGdyaWRTaXplO1xuICAgICAgICB0aGlzLnggPSB4O1xuICAgICAgICB0aGlzLnkgPSB5O1xuICAgICAgICB0aGlzLl9tYXBzID0gbWFwcztcblxuICAgICAgICB0aGlzLm1hcCA9IHRoaXMuX21hcHNbdGhpcy5yb3RhdGlvbl07XG4gICAgfVxuXG4gICAgZ2V0IHBvc2l0aW9uc09uR3JpZCgpIHtcbiAgICAgICAgY29uc3QgYWNjID0gW107XG4gICAgICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8IDQ7IHJvdysrKSB7XG4gICAgICAgICAgICBmb3IgKGxldCBjb2wgPSAwOyBjb2wgPCA0OyBjb2wrKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hcFtyb3ddW2NvbF0pIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgcG9zID0gKHRoaXMueSArIHJvdykgKiB0aGlzLl9ncmlkU2l6ZS53aWR0aCArIHRoaXMueCArIGNvbDtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHBvcyA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGFjYy5wdXNoKHBvcyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gYWNjO1xuICAgIH1cblxuICAgIHB1YmxpYyBzdG9yZSgpIHtcbiAgICAgICAgdGhpcy5fbGFzdENvbmZpZyA9IHtcbiAgICAgICAgICAgIHg6IHRoaXMueCxcbiAgICAgICAgICAgIHk6IHRoaXMueSxcbiAgICAgICAgICAgIHJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLFxuICAgICAgICAgICAgbWFwOiB0aGlzLm1hcFxuICAgICAgICB9O1xuICAgIH1cblxuICAgIHB1YmxpYyBjbGVhclN0b3JlKCkge1xuICAgICAgICB0aGlzLl9sYXN0Q29uZmlnID0gbnVsbDtcbiAgICB9XG5cbiAgICBwdWJsaWMgcmV2ZXJ0KCkge1xuICAgICAgICBpZiAodGhpcy5fbGFzdENvbmZpZykge1xuICAgICAgICAgICAgZm9yIChjb25zdCB4IGluIHRoaXMuX2xhc3RDb25maWcpIHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5fbGFzdENvbmZpZy5oYXNPd25Qcm9wZXJ0eSh4KSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBAdHMtaWdub3JlXG4gICAgICAgICAgICAgICAgICB0aGlzW3hdID0gdGhpcy5fbGFzdENvbmZpZ1t4XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHRoaXMuX2xhc3RDb25maWcgPSBudWxsO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcHVibGljIHJvdGF0ZSgpIHtcbiAgICAgICAgY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKHRoaXMuX21hcHMpO1xuICAgICAgICBsZXQgaWR4ID0ga2V5cy5pbmRleE9mKHRoaXMucm90YXRpb24udG9TdHJpbmcoKSk7XG4gICAgICAgIGlmIChpZHggPj0ga2V5cy5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0ga2V5c1swXSBhcyBhbnk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLnJvdGF0aW9uID0ga2V5c1srK2lkeF0gYXMgYW55O1xuICAgICAgICB9XG5cbiAgICAgICAgdGhpcy5tYXAgPSB0aGlzLl9tYXBzW3RoaXMucm90YXRpb25dO1xuICAgIH1cblxuICAgIHB1YmxpYyBtb3ZlRG93bigpIHtcbiAgICAgICAgdGhpcy55Kys7XG4gICAgfVxuXG4gICAgcHVibGljIG1vdmVSaWdodCgpIHtcbiAgICAgICAgdGhpcy54Kys7XG4gICAgfVxuXG4gICAgcHVibGljIG1vdmVMZWZ0KCkge1xuICAgICAgICB0aGlzLngtLTtcbiAgICB9XG5cbiAgICBnZXQgYm90dG9tUm93KCkge1xuICAgICAgICByZXR1cm4gdGhpcy55ICsgMztcbiAgICB9XG5cbiAgICBnZXQgcmlnaHRDb2woKSB7XG4gICAgICAgIGxldCBjb2wgPSAzO1xuICAgICAgICB3aGlsZSAoY29sID49IDApIHtcbiAgICAgICAgICAgIGZvciAobGV0IHJvdyA9IDA7IHJvdyA8PSAzOyByb3crKykge1xuICAgICAgICAgICAgICAgIGlmICh0aGlzLm1hcFtyb3ddW2NvbF0pIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMueCArIGNvbDtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb2wtLTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cblxuICAgIGdldCBsZWZ0Q29sKCkge1xuICAgICAgICByZXR1cm4gdGhpcy54O1xuICAgIH1cbn1cbiJdfQ==