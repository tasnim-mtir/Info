import { Component, EventEmitter, Input, Output } from '@angular/core';
import * as i0 from "@angular/core";
import * as i1 from "./services/game-manager.service";
import * as i2 from "./board/board.component";
const GAME_SPEED = 500;
const MOVE_DOWN_SPEED = 0.2; // fraction of initial game speed
export var GameState;
(function (GameState) {
    GameState[GameState["Paused"] = 0] = "Paused";
    GameState[GameState["Started"] = 1] = "Started";
    GameState[GameState["Over"] = 2] = "Over";
})(GameState || (GameState = {}));
export class TetrisCoreComponent {
    constructor(_manager) {
        this._manager = _manager;
        this.initialSpeed = GAME_SPEED;
        this.rotate = false;
        this.moveLeft = false;
        this.moveRight = false;
        this.moveDown = false;
        this.drop = false;
        this.start = false;
        this.stop = false;
        this.reset = false;
        this.lineCleared = new EventEmitter();
        this.gameOver = new EventEmitter();
        this.state = GameState.Paused;
        this.gridWidth = 10;
        this.gridHeight = 20;
        this._moveDownSpeed = GAME_SPEED * MOVE_DOWN_SPEED;
        this._manager.lineCleared$.subscribe(() => this._onLineCleared());
        this._manager.gameOver$.subscribe(() => this._onGameOver());
    }
    ngOnInit() {
        this._moveDownSpeed = this.initialSpeed * MOVE_DOWN_SPEED;
        this._manager.initialize(this.gridWidth, this.gridHeight, this.initialSpeed, this.tileSize);
        this.grid = this._manager.grid;
        setInterval(() => {
            if (this.moveDown) {
                this._manager.moveDown();
            }
        }, this._moveDownSpeed);
    }
    ngOnChanges(changes) {
        if (this._keyPressed(changes['moveLeft'])) {
            this._manager.moveLeft();
        }
        else if (this._keyPressed(changes['moveRight'])) {
            this._manager.moveRight();
        }
        else if (this._keyPressed(changes['drop'])) {
            this._manager.drop();
        }
        if (this._keyPressed(changes['rotate'])) {
            this._manager.rotate();
        }
        if (this._keyPressed(changes['start'])) {
            this._manager.start();
        }
        if (this._keyPressed(changes['stop'])) {
            this._manager.stop();
        }
        if (this._keyPressed(changes['reset'])) {
            this._manager.reset();
        }
    }
    actionLeft() { this._manager.moveLeft(); }
    actionRight() { this._manager.moveRight(); }
    actionRotate() { this._manager.rotate(); }
    actionDown() { this._manager.moveDown(); }
    actionDrop() { this._manager.drop(); }
    actionReset() { this._manager.reset(); }
    actionStart() {
        this._manager.start();
        this.state = GameState.Started;
    }
    actionStop() {
        this._manager.stop();
        this.state = GameState.Paused;
    }
    _keyPressed(key) {
        return key && key.currentValue && !key.previousValue;
    }
    _onLineCleared() {
        this.lineCleared.emit();
    }
    _onGameOver() {
        this.state = GameState.Over;
        this.gameOver.emit();
    }
}
TetrisCoreComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: TetrisCoreComponent, deps: [{ token: i1.GameManagerService }], target: i0.ɵɵFactoryTarget.Component });
TetrisCoreComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.0.2", type: TetrisCoreComponent, selector: "tetris-core", inputs: { tileSize: "tileSize", initialSpeed: "initialSpeed", rotate: "rotate", moveLeft: "moveLeft", moveRight: "moveRight", moveDown: "moveDown", drop: "drop", start: "start", stop: "stop", reset: "reset" }, outputs: { lineCleared: "lineCleared", gameOver: "gameOver" }, usesOnChanges: true, ngImport: i0, template: "<board\n    [grid]=\"grid\"></board>\n", components: [{ type: i2.BoardComponent, selector: "board", inputs: ["grid"] }] });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.0.2", ngImport: i0, type: TetrisCoreComponent, decorators: [{
            type: Component,
            args: [{ selector: 'tetris-core', template: "<board\n    [grid]=\"grid\"></board>\n" }]
        }], ctorParameters: function () { return [{ type: i1.GameManagerService }]; }, propDecorators: { tileSize: [{
                type: Input
            }], initialSpeed: [{
                type: Input
            }], rotate: [{
                type: Input
            }], moveLeft: [{
                type: Input
            }], moveRight: [{
                type: Input
            }], moveDown: [{
                type: Input
            }], drop: [{
                type: Input
            }], start: [{
                type: Input
            }], stop: [{
                type: Input
            }], reset: [{
                type: Input
            }], lineCleared: [{
                type: Output
            }], gameOver: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGV0cmlzLWNvcmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vcHJvamVjdHMvbmd4LXRldHJpcy9zcmMvbGliL3RldHJpcy1jb3JlLmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uL3Byb2plY3RzL25neC10ZXRyaXMvc3JjL2xpYi90ZXRyaXMtY29yZS5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBRUwsU0FBUyxFQUNULFlBQVksRUFDWixLQUFLLEVBR0wsTUFBTSxFQUVQLE1BQU0sZUFBZSxDQUFDOzs7O0FBR3ZCLE1BQU0sVUFBVSxHQUFHLEdBQUcsQ0FBQztBQUN2QixNQUFNLGVBQWUsR0FBRyxHQUFHLENBQUMsQ0FBQyxpQ0FBaUM7QUFFOUQsTUFBTSxDQUFOLElBQVksU0FJWDtBQUpELFdBQVksU0FBUztJQUNqQiw2Q0FBVSxDQUFBO0lBQ1YsK0NBQVcsQ0FBQTtJQUNYLHlDQUFRLENBQUE7QUFDWixDQUFDLEVBSlcsU0FBUyxLQUFULFNBQVMsUUFJcEI7QUFPRCxNQUFNLE9BQU8sbUJBQW1CO0lBd0I1QixZQUFvQixRQUE0QjtRQUE1QixhQUFRLEdBQVIsUUFBUSxDQUFvQjtRQXJCdkMsaUJBQVksR0FBVyxVQUFVLENBQUM7UUFDbEMsV0FBTSxHQUFHLEtBQUssQ0FBQztRQUNmLGFBQVEsR0FBRyxLQUFLLENBQUM7UUFDakIsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUNsQixhQUFRLEdBQUcsS0FBSyxDQUFDO1FBQ2pCLFNBQUksR0FBRyxLQUFLLENBQUM7UUFDYixVQUFLLEdBQUcsS0FBSyxDQUFDO1FBQ2QsU0FBSSxHQUFHLEtBQUssQ0FBQztRQUNiLFVBQUssR0FBRyxLQUFLLENBQUM7UUFFYixnQkFBVyxHQUFzQixJQUFJLFlBQVksRUFBRSxDQUFDO1FBQ3BELGFBQVEsR0FBc0IsSUFBSSxZQUFZLEVBQUUsQ0FBQztRQUdwRCxVQUFLLEdBQWMsU0FB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IENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9uQ2hhbmdlcyxcbiAgT25Jbml0LFxuICBPdXRwdXQsIFNpbXBsZUNoYW5nZSxcbiAgU2ltcGxlQ2hhbmdlc1xufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7R2FtZU1hbmFnZXJTZXJ2aWNlLCBUaWxlfSBmcm9tICcuL3NlcnZpY2VzL2dhbWUtbWFuYWdlci5zZXJ2aWNlJztcblxuY29uc3QgR0FNRV9TUEVFRCA9IDUwMDtcbmNvbnN0IE1PVkVfRE9XTl9TUEVFRCA9IDAuMjsgLy8gZnJhY3Rpb24gb2YgaW5pdGlhbCBnYW1lIHNwZWVkXG5cbmV4cG9ydCBlbnVtIEdhbWVTdGF0ZSB7XG4gICAgUGF1c2VkID0gMCxcbiAgICBTdGFydGVkID0gMSxcbiAgICBPdmVyID0gMlxufVxuXG5AQ29tcG9uZW50KHtcbiAgICBzZWxlY3RvcjogJ3RldHJpcy1jb3JlJyxcbiAgICB0ZW1wbGF0ZVVybDogJy4vdGV0cmlzLWNvcmUuY29tcG9uZW50Lmh0bWwnLFxuICAgIC8vIHN0eWxlVXJsczogWycuL3RldHJpcy1jb3JlLmNvbXBvbmVudC5jc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBUZXRyaXNDb3JlQ29tcG9uZW50IGltcGxlbWVudHMgT25Jbml0LCBPbkNoYW5nZXMge1xuICAgIEBJbnB1dCgpIHRpbGVTaXplOiBhbnk7XG5cbiAgICBASW5wdXQoKSBpbml0aWFsU3BlZWQ6IG51bWJlciA9IEdBTUVfU1BFRUQ7XG4gICAgQElucHV0KCkgcm90YXRlID0gZmFsc2U7XG4gICAgQElucHV0KCkgbW92ZUxlZnQgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBtb3ZlUmlnaHQgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBtb3ZlRG93biA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIGRyb3AgPSBmYWxzZTtcbiAgICBASW5wdXQoKSBzdGFydCA9IGZhbHNlO1xuICAgIEBJbnB1dCgpIHN0b3AgPSBmYWxzZTtcbiAgICBASW5wdXQoKSByZXNldCA9IGZhbHNlO1xuXG4gICAgQE91dHB1dCgpIGxpbmVDbGVhcmVkOiBFdmVudEVtaXR0ZXI8YW55PiA9IG5ldyBFdmVudEVtaXR0ZXIoKTtcbiAgICBAT3V0cHV0KCkgZ2FtZU92ZXI6IEV2ZW50RW1pdHRlcjxhbnk+ID0gbmV3IEV2ZW50RW1pdHRlcigpO1xuXG4gICAgcHVibGljIGdyaWQ6IEFycmF5PFRpbGU+O1xuICAgIHB1YmxpYyBzdGF0ZTogR2FtZVN0YXRlID0gR2FtZVN0YXRlLlBhdXNlZDtcblxuICAgIGdyaWRXaWR0aCA9IDEwO1xuICAgIGdyaWRIZWlnaHQgPSAyMDtcblxuICAgIHByaXZhdGUgX21vdmVEb3duU3BlZWQgPSBHQU1FX1NQRUVEICogTU9WRV9ET1dOX1NQRUVEO1xuXG4gICAgY29uc3RydWN0b3IocHJpdmF0ZSBfbWFuYWdlcjogR2FtZU1hbmFnZXJTZXJ2aWNlKSB7XG4gICAgICAgIHRoaXMuX21hbmFnZXIubGluZUNsZWFyZWQkLnN1YnNjcmliZSgoKSA9PiB0aGlzLl9vbkxpbmVDbGVhcmVkKCkpO1xuICAgICAgICB0aGlzLl9tYW5hZ2VyLmdhbWVPdmVyJC5zdWJzY3JpYmUoKCkgPT4gdGhpcy5fb25HYW1lT3ZlcigpKTtcbiAgICB9XG5cbiAgICBuZ09uSW5pdCgpIHtcbiAgICAgIHRoaXMuX21vdmVEb3duU3BlZWQgPSB0aGlzLmluaXRpYWxTcGVlZCAqIE1PVkVfRE9XTl9TUEVFRDtcblxuICAgICAgdGhpcy5fbWFuYWdlci5pbml0aWFsaXplKHRoaXMuZ3JpZFdpZHRoLCB0aGlzLmdyaWRIZWlnaHQsIHRoaXMuaW5pdGlhbFNwZWVkLCB0aGlzLnRpbGVTaXplKTtcbiAgICAgIHRoaXMuZ3JpZCA9IHRoaXMuX21hbmFnZXIuZ3JpZDtcblxuICAgICAgc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICBpZiAodGhpcy5tb3ZlRG93bikge1xuICAgICAgICAgIHRoaXMuX21hbmFnZXIubW92ZURvd24oKTtcbiAgICAgICAgfVxuXG4gICAgICB9LCB0aGlzLl9tb3ZlRG93blNwZWVkKTtcbiAgICB9XG5cbiAgICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgICAgIGlmICh0aGlzLl9rZXlQcmVzc2VkKGNoYW5nZXNbJ21vdmVMZWZ0J10pKSB7XG4gICAgICAgICAgICB0aGlzLl9tYW5hZ2VyLm1vdmVMZWZ0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fa2V5UHJlc3NlZChjaGFuZ2VzWydtb3ZlUmlnaHQnXSkpIHtcbiAgICAgICAgICAgIHRoaXMuX21hbmFnZXIubW92ZVJpZ2h0KCk7XG4gICAgICAgIH0gZWxzZSBpZiAodGhpcy5fa2V5UHJlc3NlZChjaGFuZ2VzWydkcm9wJ10pKSB7XG4gICAgICAgICAgICB0aGlzLl9tYW5hZ2VyLmRyb3AoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGlmICh0aGlzLl9rZXlQcmVzc2VkKGNoYW5nZXNbJ3JvdGF0ZSddKSkgeyB0aGlzLl9tYW5hZ2VyLnJvdGF0ZSgpOyB9XG4gICAgICAgIGlmICh0aGlzLl9rZXlQcmVzc2VkKGNoYW5nZXNbJ3N0YXJ0J10pKSAgeyB0aGlzLl9tYW5hZ2VyLnN0YXJ0KCk7IH1cbiAgICAgICAgaWYgKHRoaXMuX2tleVByZXNzZWQoY2hhbmdlc1snc3RvcCddKSkgIHsgdGhpcy5fbWFuYWdlci5zdG9wKCk7IH1cbiAgICAgICAgaWYgKHRoaXMuX2tleVByZXNzZWQoY2hhbmdlc1sncmVzZXQnXSkpICB7IHRoaXMuX21hbmFnZXIucmVzZXQoKTsgfVxuICAgIH1cblxuICAgIHB1YmxpYyBhY3Rpb25MZWZ0KCkgeyB0aGlzLl9tYW5hZ2VyLm1vdmVMZWZ0KCk7IH1cbiAgICBwdWJsaWMgYWN0aW9uUmlnaHQoKSB7IHRoaXMuX21hbmFnZXIubW92ZVJpZ2h0KCk7IH1cbiAgICBwdWJsaWMgYWN0aW9uUm90YXRlKCkgeyB0aGlzLl9tYW5hZ2VyLnJvdGF0ZSgpOyB9XG4gICAgcHVibGljIGFjdGlvbkRvd24oKSB7IHRoaXMuX21hbmFnZXIubW92ZURvd24oKTsgfVxuICAgIHB1YmxpYyBhY3Rpb25Ecm9wKCkgeyB0aGlzLl9tYW5hZ2VyLmRyb3AoKTsgfVxuICAgIHB1YmxpYyBhY3Rpb25SZXNldCgpIHsgdGhpcy5fbWFuYWdlci5yZXNldCgpOyB9XG5cbiAgICBwdWJsaWMgYWN0aW9uU3RhcnQoKSB7XG4gICAgICAgIHRoaXMuX21hbmFnZXIuc3RhcnQoKTtcbiAgICAgICAgdGhpcy5zdGF0ZSA9IEdhbWVTdGF0ZS5TdGFydGVkO1xuICAgIH1cbiAgICBwdWJsaWMgYWN0aW9uU3RvcCgpIHtcbiAgICAgICAgdGhpcy5fbWFuYWdlci5zdG9wKCk7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBHYW1lU3RhdGUuUGF1c2VkO1xuICAgIH1cblxuICAgIHByaXZhdGUgX2tleVByZXNzZWQoa2V5OiBTaW1wbGVDaGFuZ2UpIHtcbiAgICAgICAgcmV0dXJuIGtleSAmJiBrZXkuY3VycmVudFZhbHVlICYmICFrZXkucHJldmlvdXNWYWx1ZTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9vbkxpbmVDbGVhcmVkKCkge1xuICAgICAgICB0aGlzLmxpbmVDbGVhcmVkLmVtaXQoKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIF9vbkdhbWVPdmVyKCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gR2FtZVN0YXRlLk92ZXI7XG4gICAgICAgIHRoaXMuZ2FtZU92ZXIuZW1pdCgpO1xuICAgIH1cbn1cbiIsIjxib2FyZFxuICAgIFtncmlkXT1cImdyaWRcIj48L2JvYXJkPlxuIl19